<!DOCTYPE html>
<html lang="ru" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Каталог | Самурайские Катаны</title>
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="samurai.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* Дополнительные стили для каталога */
.catalog-header {
text-align: center;
margin-bottom: 40px;
padding: 40px 0;
background: linear-gradient(135deg, rgba(44, 62, 80, 0.05) 0%, rgba(192, 57, 43, 0.05) 100%);
border-radius: 8px;
}

.catalog-header h1 {
margin-bottom: 10px;
}

.catalog-controls {
display: flex;
justify-content: space-between;
align-items: center;
flex-wrap: wrap;
gap: 20px;
margin-bottom: 30px;
padding: 20px;
background-color: white;
border-radius: 8px;
box-shadow: var(--shadow);
border: 1px solid var(--border-color);
}

.filters-container {
display: flex;
align-items: center;
flex-wrap: wrap;
gap: 15px;
}

.filter-group {
display: flex;
flex-direction: column;
min-width: 180px;
}

.filter-group label {
font-size: 0.9rem;
color: var(--dark-text);
margin-bottom: 5px;
font-weight: 600;
}

.filter-select {
padding: 10px 15px;
border: 1px solid var(--border-color);
border-radius: 4px;
font-family: inherit;
font-size: 0.95rem;
background-color: white;
cursor: pointer;
transition: border-color 0.3s ease;
}

.filter-select:focus {
outline: none;
border-color: var(--primary-red);
}

.view-controls {
display: flex;
align-items: center;
gap: 10px;
}

.view-btn {
width: 40px;
height: 40px;
display: flex;
align-items: center;
justify-content: center;
background-color: white;
border: 1px solid var(--border-color);
border-radius: 4px;
cursor: pointer;
transition: all 0.3s ease;
}

.view-btn.active {
background-color: var(--primary-red);
color: white;
border-color: var(--primary-red);
}

.view-btn:hover {
border-color: var(--primary-red);
color: var(--primary-red);
}

.view-btn.active:hover {
color: white;
}

.catalog-stats {
font-size: 0.9rem;
color: #777;
}

.catalog-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
gap: 30px;
margin-bottom: 50px;
}

.catalog-list {
display: flex;
flex-direction: column;
gap: 20px;
margin-bottom: 50px;
}

.list-item {
display: grid;
grid-template-columns: 150px 1fr auto;
gap: 20px;
padding: 20px;
background-color: white;
border-radius: 8px;
box-shadow: var(--shadow);
border: 1px solid var(--border-color);
align-items: center;
transition: transform 0.3s ease;
}

.list-item:hover {
transform: translateY(-5px);
}

.list-item-image {
width: 150px;
height: 150px;
overflow: hidden;
border-radius: 8px;
}

.list-item-image img {
width: 100%;
height: 100%;
object-fit: cover;
transition: transform 0.5s ease;
}

.list-item:hover .list-item-image img {
transform: scale(1.05);
}

.list-item-info {
flex: 1;
}

.list-item-name {
font-size: 1.3rem;
font-weight: 600;
color: var(--primary-dark);
margin-bottom: 10px;
text-decoration: none;
display: block;
}

.list-item-name:hover {
color: var(--primary-red);
}

.list-item-description {
color: #777;
margin-bottom: 15px;
line-height: 1.5;
}

.list-item-meta {
display: flex;
gap: 20px;
flex-wrap: wrap;
}

.meta-item {
display: flex;
align-items: center;
gap: 5px;
color: #777;
font-size: 0.9rem;
}

.list-item-price {
text-align: right;
min-width: 150px;
}

.list-item-price-current {
font-size: 1.5rem;
font-weight: 700;
color: var(--primary-red);
margin-bottom: 5px;
}

.list-item-price-old {
font-size: 1rem;
color: #777;
text-decoration: line-through;
margin-bottom: 10px;
}

.pagination {
display: flex;
justify-content: center;
align-items: center;
gap: 10px;
margin-bottom: 80px;
flex-wrap: wrap;
}

.page-btn {
width: 40px;
height: 40px;
display: flex;
align-items: center;
justify-content: center;
background-color: white;
border: 1px solid var(--border-color);
border-radius: 4px;
cursor: pointer;
transition: all 0.3s ease;
font-family: inherit;
font-size: 1rem;
}

.page-btn:hover:not(.active):not(.disabled) {
border-color: var(--primary-red);
color: var(--primary-red);
}

.page-btn.active {
background-color: var(--primary-red);
color: white;
border-color: var(--primary-red);
}

.page-btn.disabled {
opacity: 0.5;
cursor: not-allowed;
}

.page-dots {
padding: 0 10px;
color: #777;
}

.active-filters {
display: flex;
flex-wrap: wrap;
gap: 10px;
margin-bottom: 20px;
}

.active-filter {
display: inline-flex;
align-items: center;
gap: 8px;
background-color: rgba(192, 57, 43, 0.1);
color: var(--primary-red);
padding: 5px 12px;
border-radius: 20px;
font-size: 0.9rem;
}

.remove-filter {
background: none;
border: none;
color: inherit;
cursor: pointer;
font-size: 1rem;
display: flex;
align-items: center;
justify-content: center;
}

.clear-filters {
background: none;
border: none;
color: var(--primary-red);
cursor: pointer;
font-size: 0.9rem;
text-decoration: underline;
}

.catalog-sidebar {
display: none;
}

@media (max-width: 768px) {
.catalog-controls {
flex-direction: column;
align-items: stretch;
}

.filters-container {
flex-direction: column;
align-items: stretch;
}

.filter-group {
min-width: 100%;
}

.list-item {
grid-template-columns: 1fr;
text-align: center;
}

.list-item-image {
margin: 0 auto;
}

.list-item-price {
text-align: center;
}

.list-item-meta {
justify-content: center;
}
}

/* Адаптация для списка */
@media (max-width: 992px) {
.list-item {
grid-template-columns: 120px 1fr;
}

.list-item-price {
grid-column: 1 / -1;
text-align: left;
border-top: 1px solid #eee;
padding-top: 15px;
display: flex;
justify-content: space-between;
align-items: center;
}
}

@media (max-width: 576px) {
.list-item {
grid-template-columns: 1fr;
}
}

/* Стили для загрузки */
.catalog-loading {
grid-column: 1 / -1;
text-align: center;
padding: 60px 20px;
}

/* Стили для пустых результатов */
.no-results {
grid-column: 1 / -1;
text-align: center;
padding: 60px 20px;
}

.no-results i {
font-size: 4rem;
color: var(--border-color);
margin-bottom: 20px;
}

.no-results h3 {
color: var(--primary-dark);
margin-bottom: 15px;
}

.no-results p {
color: #777;
margin-bottom: 30px;
max-width: 500px;
margin-left: auto;
margin-right: auto;
}

/* Фильтр по цене с ползунком */
.price-slider-container {
padding: 20px;
background-color: white;
border-radius: 8px;
box-shadow: var(--shadow);
margin-bottom: 30px;
border: 1px solid var(--border-color);
display: none;
}

.price-slider-container.active {
display: block;
}

.price-slider-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
}

.price-slider-values {
display: flex;
justify-content: space-between;
margin-top: 15px;
font-weight: 600;
color: var(--primary-dark);
}

.slider {
width: 100%;
height: 6px;
background-color: #ddd;
border-radius: 3px;
margin: 20px 0;
position: relative;
}

.slider-track {
height: 100%;
background-color: var(--primary-red);
border-radius: 3px;
position: absolute;
}

.slider-thumb {
width: 20px;
height: 20px;
background-color: white;
border: 2px solid var(--primary-red);
border-radius: 50%;
position: absolute;
top: 50%;
transform: translateY(-50%);
cursor: pointer;
box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
</style>
</head>
<body>
<!-- Самурайский декор верхний -->
<div class="samurai-border top">
<div class="mon">刀</div>
<div class="mon">集</div>
<div class="mon">目</div>
</div>

<!-- Главный контейнер -->
<div class="container">
<!-- Хедер с навигацией -->
<header class="main-header">
<div class="logo">
<h1><i class="fas fa-gem"></i> 刀屋</h1>
<p class="subtitle">Katana House | 侍の魂</p>
</div>

<nav class="main-nav">
<ul>
<li><a href="index.html"><i class="fas fa-home"></i> Главная</a></li>
<li><a href="catalog.html" class="active"><i class="fas fa-swords"></i> Каталог</a></li>
<li><a href="about.html"><i class="fas fa-landmark"></i> О нас</a></li>
<li><a href="contacts.html"><i class="fas fa-map-marked-alt"></i> Контакты</a></li>
<li><a href="cart.html" class="cart-link"><i class="fas fa-shopping-cart"></i> Корзина <span class="cart-count">0</span></a></li>
</ul>
</nav>

<button class="menu-toggle" aria-label="Меню">
<i class="fas fa-bars"></i>
</button>
</header>

<!-- Хлебные крошки -->
<nav class="breadcrumbs">
<a href="index.html">Главная</a> <i class="fas fa-chevron-right"></i>
<span>Каталог</span>
</nav>

<!-- Герой-секция каталога -->
<section class="catalog-header">
<h1><i class="fas fa-swords"></i> Каталог катан</h1>
<p>Более 120 моделей японских мечей: от традиционных до современных</p>
</section>

<!-- Активные фильтры -->
<div class="active-filters" id="activeFilters">
<!-- Активные фильтры будут добавляться через JS -->
</div>

<!-- Управление каталогом -->
<div class="catalog-controls">
<div class="filters-container">
<div class="filter-group">
<label for="categoryFilter"><i class="fas fa-filter"></i> Категория</label>
<select id="categoryFilter" class="filter-select">
<option value="">Все категории</option>
<option value="боевые">Боевые катаны</option>
<option value="декоративные">Декоративные</option>
<option value="коллекционные">Коллекционные</option>
<option value="тренировочные">Тренировочные</option>
<option value="антикварные">Антикварные</option>
</select>
</div>

<div class="filter-group">
<label for="priceFilter"><i class="fas fa-tag"></i> Цена</label>
<select id="priceFilter" class="filter-select">
<option value="">Любая цена</option>
<option value="0-20000">До 20 000 ₽</option>
<option value="20000-50000">20 000 - 50 000 ₽</option>
<option value="50000-100000">50 000 - 100 000 ₽</option>
<option value="100000-200000">100 000 - 200 000 ₽</option>
<option value="200000-999999">От 200 000 ₽</option>
</select>
</div>

<div class="filter-group">
<label for="sortBy"><i class="fas fa-sort"></i> Сортировка</label>
<select id="sortBy" class="filter-select">
<option value="default">По умолчанию</option>
<option value="price_asc">По возрастанию цены</option>
<option value="price_desc">По убыванию цены</option>
<option value="rating">По рейтингу</option>
<option value="name_asc">По названию (А-Я)</option>
<option value="name_desc">По названию (Я-А)</option>
<option value="newest">Сначала новые</option>
</select>
</div>

<div class="filter-group">
<label for="availabilityFilter"><i class="fas fa-box"></i> Наличие</label>
<select id="availabilityFilter" class="filter-select">
<option value="">Все товары</option>
<option value="in_stock">В наличии</option>
<option value="out_of_stock">Нет в наличии</option>
</select>
</div>
</div>

<div class="view-controls">
<span class="catalog-stats" id="catalogStats">Загружаем...</span>
<button class="view-btn active" id="gridView" title="Сетка">
<i class="fas fa-th"></i>
</button>
<button class="view-btn" id="listView" title="Список">
<i class="fas fa-list"></i>
</button>
</div>
</div>

<!-- Контейнер для товаров -->
<div class="catalog-content">
<!-- Сетка товаров (вид по умолчанию) -->
<div class="catalog-grid active" id="productsGrid">
<!-- Товары будут загружены через JS -->
<div class="loading">
<div class="spinner"></div>
<p>Загружаем катаны...</p>
</div>
</div>

<!-- Список товаров (скрыт по умолчанию) -->
<div class="catalog-list" id="productsList" style="display: none;">
<!-- Товары в виде списка будут загружены через JS -->
</div>
</div>

<!-- Пагинация -->
<div class="pagination" id="pagination">
<!-- Пагинация будет загружена через JS -->
</div>

<!-- Футер -->
<footer class="main-footer">
<div class="footer-content">
<div class="footer-section">
<h4>刀屋 Katana House</h4>
<p>Магазин японских катан с 2010 года. Член ассоциации "Ниппон-то".</p>
<div class="social-links">
<a href="#"><i class="fab fa-vk"></i></a>
<a href="#"><i class="fab fa-telegram"></i></a>
<a href="#"><i class="fab fa-youtube"></i></a>
<a href="#"><i class="fab fa-whatsapp"></i></a>
</div>
</div>

<div class="footer-section">
<h4>Категории</h4>
<ul>
<li><a href="#">Боевые катаны</a></li>
<li><a href="#">Декоративные</a></li>
<li><a href="#">Коллекционные</a></li>
<li><a href="#">Аксессуары</a></li>
</ul>
</div>

<div class="footer-section">
<h4>Контакты</h4>
<p><i class="fas fa-phone"></i> 8 (800) 555-35-35</p>
<p><i class="fas fa-envelope"></i> info@katanahouse.ru</p>
<p><i class="fas fa-map-marker-alt"></i> Москва, ул. Самурайская, 47</p>
</div>
</div>

<div class="footer-bottom">
<p>&copy; <span class="current-year">2023</span> Katana House. Все права защищены. | <a href="#">Политика конфиденциальности</a></p>
<p class="japanese-text">侍の道は誠実さと忠誠にある</p>
</div>
</footer>
</div>

<!-- Самурайский декор нижний -->
<div class="samurai-border bottom">
<div class="mon">武</div>
<div class="mon">勇</div>
<div class="mon">誠</div>
</div>

<!-- Мобильная навигация -->
<div class="mobile-nav" id="mobileNav">
<button class="close-nav"><i class="fas fa-times"></i></button>
<nav>
<ul>
<li><a href="index.html"><i class="fas fa-home"></i> Главная</a></li>
<li><a href="catalog.html"><i class="fas fa-swords"></i> Каталог</a></li>
<li><a href="about.html"><i class="fas fa-landmark"></i> О нас</a></li>
<li><a href="contacts.html"><i class="fas fa-map-marked-alt"></i> Контакты</a></li>
<li><a href="cart.html"><i class="fas fa-shopping-cart"></i> Корзина</a></li>
</ul>
</nav>
</div>

<!-- JavaScript файлы -->
<script src="products.js"></script>
<script src="main.js"></script>
<script>
// catalog.js - Функции для каталога

document.addEventListener('DOMContentLoaded', function() {
// Инициализация каталога
initCatalog();

// Обновление счетчика корзины
updateCartCount();
});

// Переменные для каталога
let currentView = 'grid'; // 'grid' или 'list'
let currentPage = 1;
const productsPerPage = 12;
let filteredProducts = [];

// Инициализация каталога
function initCatalog() {
// Загружаем все товары
loadAllProducts();

// Инициализация фильтров
initFilters();

// Инициализация переключателя вида
initViewToggle();

// Инициализация пагинации
initPagination();
}

// Загрузка всех товаров
function loadAllProducts() {
// Используем данные из products.js
filteredProducts = [...katanas];
updateCatalogDisplay();
}

// Инициализация фильтров
function initFilters() {
const categoryFilter = document.getElementById('categoryFilter');
const priceFilter = document.getElementById('priceFilter');
const sortBy = document.getElementById('sortBy');
const availabilityFilter = document.getElementById('availabilityFilter');

// Обработчики изменений фильтров
[categoryFilter, priceFilter, sortBy, availabilityFilter].forEach(filter => {
filter.addEventListener('change', function() {
applyFilters();
updateActiveFilters();
});
});
}

// Применение фильтров
function applyFilters() {
const category = document.getElementById('categoryFilter').value;
const priceRange = document.getElementById('priceFilter').value;
const sortBy = document.getElementById('sortBy').value;
const availability = document.getElementById('availabilityFilter').value;

// Начинаем со всех товаров
let filtered = [...katanas];

// Фильтрация по категории
if (category) {
filtered = filtered.filter(p => p.category === category);
}

// Фильтрация по цене
if (priceRange) {
const [min, max] = priceRange.split('-').map(Number);
filtered = filtered.filter(p => p.price >= min && p.price <= max);
}

// Фильтрация по наличию
if (availability === 'in_stock') {
filtered = filtered.filter(p => p.inStock);
} else if (availability === 'out_of_stock') {
filtered = filtered.filter(p => !p.inStock);
}

// Сортировка
if (sortBy === 'price_asc') {
filtered.sort((a, b) => a.price - b.price);
} else if (sortBy === 'price_desc') {
filtered.sort((a, b) => b.price - a.price);
} else if (sortBy === 'rating') {
filtered.sort((a, b) => b.rating - a.rating);
} else if (sortBy === 'name_asc') {
filtered.sort((a, b) => a.name.localeCompare(b.name));
} else if (sortBy === 'name_desc') {
filtered.sort((a, b) => b.name.localeCompare(a.name));
} else if (sortBy === 'newest') {
// Новые товары - с большим ID (предполагаем, что ID увеличивается)
filtered.sort((a, b) => b.id - a.id);
}

filteredProducts = filtered;
currentPage = 1; // Сбрасываем на первую страницу
updateCatalogDisplay();
}

// Обновление отображения каталога
function updateCatalogDisplay() {
// Показываем статистику
updateCatalogStats();

// Показываем товары в зависимости от выбранного вида
if (currentView === 'grid') {
renderGridView();
} else {
renderListView();
}

// Обновляем пагинацию
updatePagination();
}

// Обновление статистики каталога
function updateCatalogStats() {
const total = filteredProducts.length;
const start = (currentPage - 1) * productsPerPage + 1;
const end = Math.min(currentPage * productsPerPage, total);

let statsText = '';
if (total === 0) {
statsText = 'Товары не найдены';
} else if (total <= productsPerPage) {
statsText = `Показано ${total} из ${total} товаров`;
} else {
statsText = `Показано ${start}-${end} из ${total} товаров`;
}

document.getElementById('catalogStats').textContent = statsText;
}

// Рендеринг в виде сетки
function renderGridView() {
const container = document.getElementById('productsGrid');
const paginatedProducts = getPaginatedProducts();

if (paginatedProducts.length === 0) {
container.innerHTML = `
<div class="no-results">
<i class="fas fa-search"></i>
<h3>Товары не найдены</h3>
<p>Попробуйте изменить параметры фильтрации или сбросить фильтры</p>
<button class="btn btn-primary" onclick="resetFilters()">
<i class="fas fa-times"></i> Сбросить фильтры
</button>
</div>
`;
return;
}

container.innerHTML = '';

paginatedProducts.forEach(product => {
container.innerHTML += createProductCard(product);
});
}

// Рендеринг в виде списка
function renderListView() {
const container = document.getElementById('productsList');
const paginatedProducts = getPaginatedProducts();

if (paginatedProducts.length === 0) {
container.innerHTML = `
<div class="no-results">
<i class="fas fa-search"></i>
<h3>Товары не найдены</h3>
<p>Попробуйте изменить параметры фильтрации или сбросить фильтры</p>
<button class="btn btn-primary" onclick="resetFilters()">
<i class="fas fa-times"></i> Сбросить фильтры
</button>
</div>
`;
return;
}

container.innerHTML = '';

paginatedProducts.forEach(product => {
container.innerHTML += createListItem(product);
});
}

// Создание карточки товара для сетки
function createProductCard(product) {
return `
<div class="product-card" data-id="${product.id}" data-category="${product.category}">
<div class="product-image">
<img src="${product.image}" alt="${product.name}">
${!product.inStock ? '<div class="out-of-stock">Нет в наличии</div>' : ''}
</div>
<div class="product-info">
<h3 class="product-title">${product.name}</h3>
<div class="product-rating">
${generateRatingStars(product.rating)}
<span class="rating-value">${product.rating}</span>
</div>
<p class="product-price">${formatPrice(product.price)}</p>
<div class="product-actions">
<a href="product.html?id=${product.id}" class="btn btn-small btn-details">Подробнее</a>
<button class="btn btn-small btn-cart add-to-cart" ${!product.inStock ? 'disabled' : ''} data-id="${product.id}">
<i class="fas fa-shopping-cart"></i> ${product.inStock ? 'В корзину' : 'Нет в наличии'}
</button>
</div>
</div>
</div>
`;
}

// Создание элемента списка
function createListItem(product) {
return `
<div class="list-item" data-id="${product.id}" data-category="${product.category}">
<div class="list-item-image">
<img src="${product.image}" alt="${product.name}">
</div>
<div class="list-item-info">
<a href="product.html?id=${product.id}" class="list-item-name">${product.name}</a>
<p class="list-item-description">${product.description}</p>
<div class="list-item-meta">
<span class="meta-item">
<i class="fas fa-star" style="color: var(--samurai-gold);"></i>
${product.rating}
</span>
<span class="meta-item">
<i class="fas fa-layer-group"></i>
${getCategoryName(product.category)}
</span>
<span class="meta-item ${product.inStock ? 'in-stock' : 'out-of-stock'}">
<i class="fas ${product.inStock ? 'fa-check-circle' : 'fa-times-circle'}"></i>
${product.inStock ? 'В наличии' : 'Нет в наличии'}
</span>
</div>
</div>
<div class="list-item-price">
<div class="list-item-price-current">${formatPrice(product.price)}</div>
<div class="list-item-price-old">${formatPrice(product.price * 1.1)}</div>
<div class="product-actions">
<a href="product.html?id=${product.id}" class="btn btn-small btn-details">Подробнее</a>
<button class="btn btn-small btn-cart add-to-cart" ${!product.inStock ? 'disabled' : ''} data-id="${product.id}">
<i class="fas fa-shopping-cart"></i> ${product.inStock ? 'В корзину' : 'Нет в наличии'}
</button>
</div>
</div>
</div>
`;
}

// Получение пагинированных товаров
function getPaginatedProducts() {
const start = (currentPage - 1) * productsPerPage;
const end = start + productsPerPage;
return filteredProducts.slice(start, end);
}

// Инициализация переключателя вида
function initViewToggle() {
const gridViewBtn = document.getElementById('gridView');
const listViewBtn = document.getElementById('listView');
const gridContainer = document.getElementById('productsGrid');
const listContainer = document.getElementById('productsList');

gridViewBtn.addEventListener('click', function() {
if (currentView === 'list') {
currentView = 'grid';
gridViewBtn.classList.add('active');
listViewBtn.classList.remove('active');
gridContainer.classList.add('active');
listContainer.style.display = 'none';
renderGridView();
}
});

listViewBtn.addEventListener('click', function() {
if (currentView === 'grid') {
currentView = 'list';
listViewBtn.classList.add('active');
gridViewBtn.classList.remove('active');
gridContainer.classList.remove('active');
listContainer.style.display = 'block';
renderListView();
}
});
}

// Инициализация пагинации
function initPagination() {
// Пагинация обновляется динамически в updatePagination()
}

// Обновление пагинации
function updatePagination() {
const container = document.getElementById('pagination');
const totalPages = Math.ceil(filteredProducts.length / productsPerPage);

if (totalPages <= 1) {
container.innerHTML = '';
return;
}

let paginationHTML = '';

// Кнопка "Назад"
if (currentPage > 1) {
paginationHTML += `
<button class="page-btn" onclick="goToPage(${currentPage - 1})">
<i class="fas fa-chevron-left"></i>
</button>
`;
} else {
paginationHTML += `
<button class="page-btn disabled">
<i class="fas fa-chevron-left"></i>
</button>
`;
}

// Первая страница
paginationHTML += `
<button class="page-btn ${currentPage === 1 ? 'active' : ''}" onclick="goToPage(1)">
1
</button>
`;

// Промежуточные страницы
let startPage = Math.max(2, currentPage - 1);
let endPage = Math.min(totalPages - 1, currentPage + 1);

if (currentPage > 3) {
paginationHTML += `<span class="page-dots">...</span>`;
}

for (let i = startPage; i <= endPage; i++) {
if (i > 1 && i < totalPages) {
paginationHTML += `
<button class="page-btn ${currentPage === i ? 'active' : ''}" onclick="goToPage(${i})">
${i}
</button>
`;
}
}

if (currentPage < totalPages - 2) {
paginationHTML += `<span class="page-dots">...</span>`;
}

// Последняя страница (если она не первая)
if (totalPages > 1) {
paginationHTML += `
<button class="page-btn ${currentPage === totalPages ? 'active' : ''}" onclick="goToPage(${totalPages})">
${totalPages}
</button>
`;
}

// Кнопка "Вперед"
if (currentPage < totalPages) {
paginationHTML += `
<button class="page-btn" onclick="goToPage(${currentPage + 1})">
<i class="fas fa-chevron-right"></i>
</button>
`;
} else {
paginationHTML += `
<button class="page-btn disabled">
<i class="fas fa-chevron-right"></i>
</button>
`;
}

container.innerHTML = paginationHTML;
}

// Переход на страницу
function goToPage(page) {
currentPage = page;
updateCatalogDisplay();
window.scrollTo({ top: 0, behavior: 'smooth' });
}

// Обновление активных фильтров
function updateActiveFilters() {
const container = document.getElementById('activeFilters');
const category = document.getElementById('categoryFilter').value;
const priceRange = document.getElementById('priceFilter').value;
const availability = document.getElementById('availabilityFilter').value;

container.innerHTML = '';

let hasFilters = false;

// Категория
if (category) {
hasFilters = true;
const categoryName = getCategoryName(category);
container.innerHTML += `
<div class="active-filter">
<span>Категория: ${categoryName}</span>
<button class="remove-filter" onclick="removeFilter('category')">
<i class="fas fa-times"></i>
</button>
</div>
`;
}

// Цена
if (priceRange) {
hasFilters = true;
const [min, max] = priceRange.split('-').map(Number);
const priceText = max === 999999 ? `От ${formatPrice(min)}` : `${formatPrice(min)} - ${formatPrice(max)}`;
container.innerHTML += `
<div class="active-filter">
<span>Цена: ${priceText}</span>
<button class="remove-filter" onclick="removeFilter('price')">
<i class="fas fa-times"></i>
</button>
</div>
`;
}

// Наличие
if (availability) {
hasFilters = true;
const availabilityName = availability === 'in_stock' ? 'В наличии' : 'Нет в наличии';
container.innerHTML += `
<div class="active-filter">
<span>Наличие: ${availabilityName}</span>
<button class="remove-filter" onclick="removeFilter('availability')">
<i class="fas fa-times"></i>
</button>
</div>
`;
}

// Кнопка сброса всех фильтров
if (hasFilters) {
container.innerHTML += `
<button class="clear-filters" onclick="resetFilters()">
<i class="fas fa-times"></i> Сбросить все фильтры
</button>
`;
}
}

// Удаление фильтра
function removeFilter(filterType) {
switch(filterType) {
case 'category':
document.getElementById('categoryFilter').value = '';
break;
case 'price':
document.getElementById('priceFilter').value = '';
break;
case 'availability':
document.getElementById('availabilityFilter').value = '';
break;
}
applyFilters();
updateActiveFilters();
}

// Сброс всех фильтров
function resetFilters() {
document.getElementById('categoryFilter').value = '';
document.getElementById('priceFilter').value = '';
document.getElementById('sortBy').value = 'default';
document.getElementById('availabilityFilter').value = '';

applyFilters();
updateActiveFilters();
showNotification('Все фильтры сброшены');
}

// Вспомогательные функции
function getCategoryName(categoryCode) {
const categories = {
'боевые': 'Боевые катаны',
'декоративные': 'Декоративные',
'коллекционные': 'Коллекционные',
'тренировочные': 'Тренировочные',
'антикварные': 'Антикварные'
};
return categories[categoryCode] || categoryCode;
}

// Форматирование цены (из products.js)
function formatPrice(price) {
return price.toLocaleString('ru-RU') + ' ₽';
}

// Генерация звезд рейтинга (из products.js)
function generateRatingStars(rating) {
let stars = '';
const fullStars = Math.floor(rating);
const hasHalfStar = rating % 1 >= 0.5;

for (let i = 0; i < fullStars; i++) {
stars += '<i class="fas fa-star"></i>';
}

if (hasHalfStar) {
stars += '<i class="fas fa-star-half-alt"></i>';
}

const emptyStars = 5 - Math.ceil(rating);
for (let i = 0; i < emptyStars; i++) {
stars += '<i class="far fa-star"></i>';
}

return stars;
}

// Обновление счетчика корзины
function updateCartCount() {
const cart = JSON.parse(localStorage.getItem('katanaCart')) || [];
const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);

document.querySelectorAll('.cart-count').forEach(element => {
element.textContent = totalItems;
});
}

// Уведомления
function showNotification(message) {
const notification = document.createElement('div');
notification.className = 'notification';
notification.innerHTML = `
<div class="notification-content">
<i class="fas fa-check-circle"></i>
<span>${message}</span>
</div>
`;

notification.style.cssText = `
position: fixed;
top: 100px;
right: 20px;
background-color: var(--primary-green);
color: white;
padding: 15px 20px;
border-radius: 5px;
box-shadow: 0 5px 15px rgba(0,0,0,0.2);
z-index: 10000;
transform: translateX(150%);
transition: transform 0.3s ease;
max-width: 300px;
`;

document.body.appendChild(notification);

setTimeout(() => {
notification.style.transform = 'translateX(0)';
}, 10);

setTimeout(() => {
notification.style.transform = 'translateX(150%)';
setTimeout(() => {
if (notification.parentNode) {
notification.parentNode.removeChild(notification);
}
}, 300);
}, 3000);
}

// Инициализация обработчиков для кнопок "В корзину"
document.addEventListener('click', function(e) {
if (e.target.classList.contains('add-to-cart') || e.target.closest('.add-to-cart')) {
const button = e.target.classList.contains('add-to-cart') ? e.target : e.target.closest('.add-to-cart');
const productId = parseInt(button.getAttribute('data-id'));

// Находим товар в массиве
const product = katanas.find(p => p.id === productId);

if (!product) return;

// Проверяем наличие
if (!product.inStock) {
showNotification('Этот товар временно отсутствует на складе');
return;
}

// Добавляем товар в корзину
let cart = JSON.parse(localStorage.getItem('katanaCart')) || [];
const existingItem = cart.find(item => item.id === productId);

if (existingItem) {
existingItem.quantity += 1;
} else {
cart.push({
id: product.id,
name: product.name,
price: product.price,
image: product.image,
quantity: 1
});
}

localStorage.setItem('katanaCart', JSON.stringify(cart));
updateCartCount();
showNotification(`«${product.name}» добавлен в корзину`);
}
});

// Запуск каталога при загрузке
initCatalog();
</script>
</body>
</html>
